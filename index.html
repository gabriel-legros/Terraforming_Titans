<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Update title maybe? -->
    <title>Terraforming Titans</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <!-- Stylesheets -->
    <link rel="stylesheet" href="src/css/style.css">
    <link rel="stylesheet" href="src/css/day-night-cycleUI.css">
    <link rel="stylesheet" href="src/css/save.css">
    <link rel="stylesheet" href="src/css/structure.css">
    <link rel="stylesheet" href="src/css/colonies.css">
    <link rel="stylesheet" href="src/css/research.css">
    <link rel="stylesheet" href="src/css/pop-up.css">
    <link rel="stylesheet" href="src/css/projects.css">
    <link rel="stylesheet" href="src/css/resource.css">
    <link rel="stylesheet" href="src/css/terraforming.css">
    <link rel="stylesheet" href="src/css/gold-asteroid.css">
    <link rel="stylesheet" href="src/css/warning.css">
    <link rel="stylesheet" href="src/css/life.css">
    <link rel="stylesheet" href="src/css/milestones.css">
    <!-- Add CSS for the new Space tab if needed -->
    <link rel="stylesheet" href="src/css/space.css">
    <!-- Add CSS for the new HOPE tab -->
    <link rel="stylesheet" href="src/css/skillsUI.css">
    <link rel="stylesheet" href="src/css/solis.css">
    <link rel="stylesheet" href="src/css/pause.css">
    <link rel="stylesheet" href="src/css/wgc.css">

    <!-- Parameter Scripts -->
    <script src="src/js/planet-parameters.js"></script>
    <script src="src/js/life-parameters.js"></script>
    <script src="src/js/buildings-parameters.js"></script>
    <script src="src/js/colony-parameters.js"></script>
    <script src="src/js/project-parameters.js"></script>
    <script src="src/js/research-parameters.js"></script>
    <script src="src/js/skills-parameters.js"></script>
    <script src="src/js/story/mars.js"></script>
    <script src="src/js/story/titan.js"></script>
    <script src="src/js/story/callisto.js"></script>
    <script src="src/js/story/ganymede.js"></script>
    <script src="src/js/progress-data.js"></script>

    <!-- Core Scripts -->
    <script src="src/js/numbers.js"></script>
    <script src="src/js/buildCount.js"></script>
    <script src="src/js/effectable-entity.js"></script>
    <script src="src/js/tab.js"></script>
    <script src="src/js/ui-utils.js"></script>
    <script src="src/js/save.js"></script>
    <script src="src/js/structuresUI.js"></script>
    <script src="src/js/day-night-cycle.js"></script>
    <script src="src/js/day-night-setting.js"></script>
    <script src="src/js/ore-scanning.js"></script>
    <script src="src/js/advanced-research/self-replicating-ships.js"></script>
    <script src="src/js/advanced-research/hive-mind-androids.js"></script>
    <script src="src/js/resource.js"></script>
    <script src="src/js/resourceUI.js"></script>
    <script src="src/js/building.js"></script>
    <script src="src/js/buildingUI.js"></script>
    <script src="src/js/colony.js"></script>
    <script src="src/js/colonyUI.js"></script>
    <script src="src/js/colonySliders.js"></script>
    <script src="src/js/colonySlidersUI.js"></script>
    <script src="src/js/projects.js"></script>
    <script src="src/js/projects/SpaceshipProject.js"></script>
    <script src="src/js/projects/ScannerProject.js"></script>
    <script src="src/js/projects/SpaceMiningProject.js"></script>
    <script src="src/js/projects/SpaceMirrorFacilityProject.js"></script>
    <script src="src/js/projects/SpaceExportBaseProject.js"></script>
    <script src="src/js/projects/SpaceExportProject.js"></script>
    <script src="src/js/projects/SpaceDisposalProject.js"></script>
    <script src="src/js/projects/AndroidProject.js"></script>
    <script src="src/js/projects/DeeperMiningProject.js"></script>
    <script src="src/js/projects/PlanetaryThrustersProject.js"></script>
    <script src="src/js/projects/CargoRocketProject.js"></script>
    <script src="src/js/projects/dysonswarm.js"></script>
    <script src="src/js/projects/dysonswarmUI.js"></script>
    <script src="src/js/projectsUI.js"></script>
    <script src="src/js/research.js"></script>
    <script src="src/js/skills.js"></script>
    <script src="src/js/skillsUI.js"></script>
    <script src="src/js/researchUI.js"></script>
    <script src="src/js/funding.js"></script>
    <script src="src/js/population.js"></script>
    <script src="src/js/pop-up.js"></script>
    <script src="src/js/journal.js"></script>
    <script src="src/js/journal-reconstruction.js"></script>
    <script src="src/js/progress.js"></script>
    <script src="src/js/physics.js"></script>
    <script src="src/js/phase-change-utils.js"></script>
    <script src="src/js/hydrology.js"></script>
    <script src="src/js/condensation-utils.js"></script>
    <script src="src/js/water-cycle.js"></script>
    <script src="src/js/atmo-collector-trigger.js"></script>
    <script src="src/js/dry-ice-cycle.js"></script>
    <script src="src/js/hydrocarbon-cycle.js"></script>
    <script src="src/js/zones.js"></script>
    <script src="src/js/terraforming-utils.js"></script>
    <script src="src/js/terraforming.js"></script>
    <script src="src/js/terraformingUI.js"></script>
    <script src="src/js/life.js"></script>
    <script src="src/js/lifeUI.js"></script>
    <script src="src/js/milestones.js"></script>
    <script src="src/js/milestonesUI.js"></script>
    <script src="src/js/hopeUI.js"></script>
    <script src="src/js/solis.js"></script>
    <script src="src/js/solisUI.js"></script>
    <script src="src/js/wgc.js"></script>
    <script src="src/js/wgcUI.js"></script>
    <script src="src/js/globals.js"></script>
    <script src="src/js/game-speed.js"></script>
    <script src="src/js/autobuild.js"></script>
    <script src="src/js/gold-asteroid.js"></script>
    <script src="src/js/space.js"></script>
    <script src="src/js/spaceUI.js"></script>
    <script src="src/js/warning.js"></script>
    <script src="src/js/game-effects.js"></script>
    <script src="src/js/game.js"></script>
    <script src="src/js/pause.js"></script>
    <script src="src/js/debug-tools.js"></script>
</head>

<body>

<div id="game-container">

  <!-- Tab Navigation -->
  <div class="tabs">
    <div class="tab hidden" id="buildings-tab" data-tab="buildings">Buildings<span id="buildings-alert" class="unlock-alert">!</span></div>
    <div class="tab hidden" id="special-projects-tab" data-tab="special-projects">Special Projects<span id="projects-alert" class="unlock-alert">!</span></div>
    <div class="tab hidden" id="colonies-tab" data-tab="colonies">Colony</div>
    <div class="tab hidden" id="research-tab" data-tab="research">Research</div>
    <div class="tab hidden" id="terraforming-tab" data-tab="terraforming">Terraforming<span id="terraforming-alert" class="milestone-alert">!</span></div>
    <!-- *** NEW SPACE TAB BUTTON *** -->
    <div class="tab hidden" id="space-tab" data-tab="space">Space</div>
    <!-- *************************** -->
    <!-- *** NEW HOPE TAB BUTTON *** -->
    <div class="tab hidden" id="hope-tab" data-tab="hope">H.O.P.E.<span id="hope-alert" class="hope-alert">!</span></div>
    <!-- ***************************** -->
    <div class="tab active" id="settings-tab" data-tab="settings">Save and Settings</div>
  </div>

  <div class="top-bar">
    <div class="day-night-progress-bar-container">
      <span id="progress-text" class="progress-text">Day Progress</span>
      <div id="day-night-progress-bar" class="day-night-progress-bar"></div>
    </div>
  </div>
<div id="show-journal-button" class="hidden">&laquo;</div>
    <!-- Game Content Tabs -->
    <div class="tab-content-wrapper">

      <!-- Resource Bar (always visible) -->
      <div class="resource-wrapper">
        <div id = "special-messages">
          <div id="warning-container"></div>
          <div id="pause-container"></div>
          <div id="festival-container"></div>
          <div id="gold-asteroid-container"></div>
        </div>
        <div class="resource-container" id="resources-container">
            <!-- Resources will be dynamically inserted here -->
        </div>
      </div>

    <!-- Buildings Tab Content -->
    <div id="buildings" class="tab-content">
        <!-- ... existing buildings content ... -->
        <div class="container hidden" id="building-container">
            <div class="buildings-subtabs">
                <div id="resource-buildings-tab" class="building-subtab" data-subtab="resource-buildings">Resources<span id="resource-buildings-alert" class="unlock-alert">!</span></div>
                <div id="production-buildings-tab" class="building-subtab" data-subtab="production-buildings">Production<span id="production-buildings-alert" class="unlock-alert">!</span></div>
                <div id="energy-buildings-tab" class="building-subtab" data-subtab="energy-buildings">Energy<span id="energy-buildings-alert" class="unlock-alert">!</span></div>
                <div id="storage-buildings-tab" class="building-subtab" data-subtab="storage-buildings">Storage<span id="storage-buildings-alert" class="unlock-alert">!</span></div>
                <div id="terraforming-buildings-tab" class="building-subtab" data-subtab="terraforming-buildings">Terraforming<span id="terraforming-buildings-alert" class="unlock-alert">!</span></div>
            </div>
            <div class="building-subtab-content-wrapper">
                <div id="resource-buildings" class="building-subtab-content">
                    <div class="category-header">
                      <h3>Resource Buildings</h3>
                      <div class="unhide-obsolete-container" id="resource-unhide-container" style="display: none;">
                        <button id="resource-unhide-button" class="unhide-obsolete-button">Unhide Obsolete Buildings</button>
                      </div>
                    </div>
                    <div class="building-list" id="resource-buildings-buttons"></div>
                </div>
                <div id="production-buildings" class="building-subtab-content">
                    <div class="category-header">
                      <h3>Production Buildings</h3>
                      <div class="unhide-obsolete-container" id="production-unhide-container" style="display: none;">
                        <button id="production-unhide-button" class="unhide-obsolete-button">Unhide Obsolete Buildings</button>
                      </div>
                    </div>
                    <div class="building-list" id="production-buildings-buttons"></div>
                </div>
                <div id="energy-buildings" class="building-subtab-content">
                    <div class="category-header">
                      <h3>Energy Buildings</h3>
                      <div class="unhide-obsolete-container" id="energy-unhide-container" style="display: none;">
                        <button id="energy-unhide-button" class="unhide-obsolete-button">Unhide Obsolete Buildings</button>
                      </div>
                    </div>
                    <div class="building-list" id="energy-buildings-buttons"></div>
                </div>
                <div id="storage-buildings" class="building-subtab-content">
                    <div class="category-header">
                      <h3>Storage Buildings</h3>
                      <div class="unhide-obsolete-container" id="storage-unhide-container" style="display: none;">
                        <button id="storage-unhide-button" class="unhide-obsolete-button">Unhide Obsolete Buildings</button>
                      </div>
                    </div>
                    <div class="building-list" id="storage-buildings-buttons"></div>
                </div>
                <div id="terraforming-buildings" class="building-subtab-content">
                    <div class="category-header">
                      <h3>Terraforming Buildings</h3>
                      <div class="unhide-obsolete-container" id="terraforming-unhide-container" style="display: none;">
                        <button id="terraforming-unhide-button" class="unhide-obsolete-button">Unhide Obsolete Buildings</button>
                      </div>
                    </div>
                    <div class="building-list" id="terraforming-buildings-buttons"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Special Projects Tab Content -->
    <div id="special-projects" class="tab-content">
        <!-- ... existing special projects content ... -->
        <div class="container special-projects-container">
          <div class="projects-subtabs">
            <div id="resources-projects-tab" class="projects-subtab active" data-subtab="resources-projects">Resources<span id="resources-projects-alert" class="unlock-alert">!</span></div>
            <div id="infrastructure-projects-tab" class="projects-subtab" data-subtab="infrastructure-projects">Infrastructure<span id="infrastructure-projects-alert" class="unlock-alert">!</span></div>
            <div id="mega-projects-tab" class="projects-subtab hidden" data-subtab="mega-projects">Mega<span id="mega-projects-alert" class="unlock-alert">!</span></div>
            <div id="story-projects-tab" class="projects-subtab hidden" data-subtab="story-projects">Story<span id="story-projects-alert" class="unlock-alert">!</span></div>
          </div>
          <div class="projects-subtab-content-wrapper">
            <div id="resources-projects" class="projects-subtab-content active">
              <div class="projects-list" id="resources-projects-list"></div>
            </div>
            <div id="infrastructure-projects" class="projects-subtab-content">
              <div class="projects-list" id="infrastructure-projects-list"></div>
            </div>
            <div id="mega-projects" class="projects-subtab-content hidden">
              <div class="projects-list" id="mega-projects-list"></div>
            </div>
            <div id="story-projects" class="projects-subtab-content hidden">
              <div class="projects-list" id="story-projects-list"></div>
            </div>
          </div>
        </div>
      </div>

    <!-- Colonies Tab Content -->
    <div id="colonies" class="tab-content">
        <!-- ... existing colonies content ... -->
         <div class="container colonies-container">
              <div class="header-container">
                <h2>Colonies</h2>
              </div>
              <div id="colony-controls-container">
                <div id="colony-sliders-container"></div>
                <div id="right-controls-container">
                  <div id="unhide-obsolete-container" class="unhide-obsolete-container" style="display: none;">
                    <button id="unhide-obsolete-button" class="unhide-obsolete-button">Unhide Obsolete Buildings</button>
                  </div>
                </div>
              </div>
              <div class="building-list" id="colony-buildings-buttons"></div>
            </div>
    </div>

    <!-- Research Tab Content -->
    <div id="research" class="tab-content">
        <!-- ... existing research content ... -->
         <div class="container">
            <div class="research-subtabs">
                <div class="research-subtab active" data-subtab="energy-research">Energy</div>
                <div class="research-subtab" data-subtab="industry-research">Industry</div>
                <div class="research-subtab" data-subtab="colonization-research">Colonization</div>
                <div class="research-subtab" data-subtab="terraforming-research">Terraforming</div>
                <div class="research-subtab hidden" data-subtab="advanced-research">Advanced</div>
            </div>
            <div class="subtab-content-wrapper">
                <div id="energy-research" class="research-subtab-content active">
                  <div class="research-header">
                    <span class="research-title">Energy Research</span>
                    <button class="toggle-completed-button">Toggle Completed</button>
                  </div>
                  <div class="research-list" id="energy-research-buttons"></div>
                </div>
                <div id="industry-research" class="research-subtab-content">
                  <div class="research-header">
                    <span class="research-title">Industry Research</span>
                    <button class="toggle-completed-button">Toggle Completed</button>
                  </div>
                  <div class="research-list" id="industry-research-buttons"></div>
                </div>
                <div id="colonization-research" class="research-subtab-content">
                  <div class="research-header">
                    <span class="research-title">Colonization Research</span>
                    <button class="toggle-completed-button">Toggle Completed</button>
                  </div>
                  <div class="research-list" id="colonization-research-buttons"></div>
                </div>
                <div id="terraforming-research" class="research-subtab-content">
                  <div class="research-header">
                    <span class="research-title">Terraforming Research</span>
                    <button class="toggle-completed-button">Toggle Completed</button>
                  </div>
                  <div class="research-list" id="terraforming-research-buttons"></div>
                </div>
                <div id="advanced-research" class="research-subtab-content hidden">
                  <div class="research-header">
                    <span class="research-title">Advanced Research</span>
                    <button class="toggle-completed-button">Toggle Completed</button>
                  </div>
                  <div class="research-list" id="advanced-research-buttons"></div>
                </div>
              </div>
        </div>
    </div>

    <!-- Terraforming Tab Content -->
    <div id="terraforming" class="tab-content">
      <!-- ... existing terraforming content ... -->
       <div class="container">
        <div class="terraforming-subtabs">
          <div class="terraforming-subtab active" data-subtab="summary-terraforming">Summary</div>
          <div class="terraforming-subtab" data-subtab="life-terraforming">Life</div>
          <div class="terraforming-subtab" data-subtab="milestone-terraforming">Milestones<span id="milestone-subtab-alert" class="milestone-alert">!</span></div>
      </div>
      <div class="terraforming-subtab-content-wrapper">
          <div id = "summary-terraforming" class="terraforming-subtab-content active">
              <div id="play-time-display">0 days</div>
               <!-- Terraforming UI goes here -->
          </div>
          <div id = "life-terraforming" class="terraforming-subtab-content">
            <h2>Life</h2>
             <!-- Life UI goes here -->
          </div>
          <div id = "milestone-terraforming" class="terraforming-subtab-content">
            <h2>Milestones</h2>
            <div class="milestone-options">
                <label><input type="checkbox" id="milestone-silence-toggle"> Silence milestone alert</label>
            </div>
             <!-- Milestones UI goes here -->
          </div>
        </div>
      </div>
    </div>

    <!-- *** NEW SPACE TAB CONTENT *** -->
    <div id="space" class="tab-content">
        <div class="container space-container"> <!-- Add specific class if needed -->
            <h2>Planet Selection</h2>
            <div id="planet-selection-options">
                <!-- Planet options will be added dynamically here later -->
            </div>
            <div id="travel-status">
                <!-- Status messages about travel preparation/progress -->
            </div>
        </div>
    </div>
    <!-- *************************** -->

    <!-- *** NEW HOPE TAB CONTENT *** -->
    <div id="hope" class="tab-content">
        <div class="container hope-container">
            <div class="hope-subtabs">
                <div class="hope-subtab active" data-subtab="awakening-hope">Awakening</div>
                <div class="hope-subtab hidden" data-subtab="solis-hope">Solis<span id="solis-subtab-alert" class="hope-alert">!</span></div>
                <div class="hope-subtab hidden" data-subtab="wgc-hope">WGC</div>
            </div>
            <div class="hope-subtab-content-wrapper">
                <div id="awakening-hope" class="hope-subtab-content active">
                    <div id="skill-points-display">Skill Points: <span id="skill-points-value">0</span></div>
                    <div id="skill-tree" class="skill-tree"></div>
                </div>
                <div id="solis-hope" class="hope-subtab-content hidden">
                    <div class="solis-container">
                        <div class="solis-header">
                            <h2>Solis Quests</h2>
                            <div id="solis-points-display">Solis Points: <span id="solis-points-value">0</span></div>
                        </div>
                        <div class="solis-quest-area">
                            <div id="solis-quest-text">No quest available</div>
                            <div id="solis-cooldown" class="hidden"></div>
                        </div>
                        <div class="solis-controls">
                            <div class="solis-reward-control">
                                <span>Reward: <span id="solis-reward">1</span> point(s)</span>
                                <button id="solis-multiply-button" class="solis-multiplier-button">+</button>
                                <button id="solis-divide-button" class="solis-multiplier-button">-</button>
                            </div>
                            <div class="solis-buttons">
                                <button id="solis-refresh-button">Refresh</button>
                                <button id="solis-complete-button">Complete Quest</button>
                            </div>
                        </div>
                        <div class="solis-options">
                            <label>
                                <input type="checkbox" id="solis-silence-toggle"> Silence quest alert
                            </label>
                        </div>
                        <div class="solis-shop">
                            <div id="solis-shop-items"></div>
                        </div>
                    </div>
                </div>
                <div id="wgc-hope" class="hope-subtab-content hidden">
                    <!-- UI generated dynamically -->
                </div>
            </div>
        </div>
    </div>
    <!-- ***************************** -->

    <!-- Settings Tab Content -->
    <div id="settings" class="tab-content active">
      <!-- ... existing settings content ... -->
      <div class="container settings-container">
          <h2>Save</h2>
          <div class="save-slots">
              <!-- ... table ... -->
              <table>
                  <thead>
                      <tr>
                          <th>Slot</th>
                          <th>Date</th>
                          <th>Actions</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr>
                        <td>Autosave</td>
                        <td id="autosave-date">Empty</td>
                        <td>
                            <button class="save-button" data-slot="autosave" disabled>Save</button>
                            <button class="load-button" data-slot="autosave">Load</button>
                            <button class="delete-button" data-slot="autosave">Delete</button>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="3">
                            <div id="autosave-text"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>Slot 1</td>
                        <td id="slot1-date">Empty</td>
                        <td>
                            <button class="save-button" data-slot="slot1">Save</button>
                            <button class="load-button" data-slot="slot1">Load</button>
                            <button class="delete-button" data-slot="slot1">Delete</button>
                        </td>
                    </tr>
                    <!-- ... other slots ... -->
                     <tr>
                          <td>Slot 2</td>
                          <td id="slot2-date">Empty</td>
                          <td>
                              <button class="save-button" data-slot="slot2">Save</button>
                              <button class="load-button" data-slot="slot2">Load</button>
                              <button class="delete-button" data-slot="slot2">Delete</button>
                          </td>
                      </tr>
                      <tr>
                          <td>Slot 3</td>
                          <td id="slot3-date">Empty</td>
                          <td>
                              <button class="save-button" data-slot="slot3">Save</button>
                              <button class="load-button" data-slot="slot3">Load</button>
                              <button class="delete-button" data-slot="slot3">Delete</button>
                          </td>
                      </tr>
                      <tr>
                          <td>Slot 4</td>
                          <td id="slot4-date">Empty</td>
                          <td>
                              <button class="save-button" data-slot="slot4">Save</button>
                              <button class="load-button" data-slot="slot4">Load</button>
                              <button class="delete-button" data-slot="slot4">Delete</button>
                          </td>
                      </tr>
                      <tr>
                          <td>Slot 5</td>
                          <td id="slot5-date">Empty</td>
                          <td>
                              <button class="save-button" data-slot="slot5">Save</button>
                              <button class="load-button" data-slot="slot5">Load</button>
                              <button class="delete-button" data-slot="slot5">Delete</button>
                          </td>
                      </tr>
                      <tr>
                        <td colspan="3">
                          <button id="new-game-button">New Game</button>
                          <button id="save-to-file-button">Save to File</button>
                          <input type="file" id="load-from-file-input" accept=".json" style="display: none;">
                          <button id="load-from-file-button">Load from File</button>
                        </td>
                      </tr>
                        <tr>
                          <td colspan="3">
                            <button id="pause-button">Pause</button>
                          </td>
                        </tr>
                  </tbody>
              </table>
          </div>
          <h2>Settings</h2>
          <label style="display:block;margin-bottom:8px;">
            <input type="checkbox" id="celsius-toggle"> Display temperature in Celsius
          </label>
          <label style="display:block;margin-bottom:8px;">
            <input type="checkbox" id="unlock-alert-toggle"> Disable unlock alerts
          </label>
          <label style="display:block;margin-bottom:8px;">
            <input type="checkbox" id="day-night-toggle"> Disable day-night cycle <span class="info-tooltip-icon" title="Stops time of day changes. Solar Panels and Ice Harvesters run at half efficiency and half maintenance.  Leads to a more realistic, slightly easier and more relaxed experience.">&#9432;</span>
          </label>
      </div>
    </div>

    <!-- Journal Section -->
    <div id="journal" class="journal">
        <h3><span id="journal-toggle-icon">&raquo;</span> Journal <span id="journal-nav-container"><span id="journal-prev" class="journal-nav">&#9664;</span><span id="journal-next" class="journal-nav">&#9654;</span></span></h3>
        <div id="current-objective" class="current-objective"></div>
        <div id="journal-entries">
            <!-- Journal entries will be dynamically inserted here -->
        </div>
    </div>

    </div> <!-- End tab-content-wrapper -->

</div> <!-- End game-container -->

    <script>
    // Consolidated Tab Switching Logic
    function activateTab(tabId) {
        // Deactivate all tabs and content
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));

        // Activate the selected tab button and content
        const tabButton = document.querySelector(`.tab[data-tab="${tabId}"]`);
        const tabContent = document.getElementById(tabId);

        if (tabButton && !tabButton.classList.contains('hidden')) { // Only activate if not hidden
            tabButton.classList.add('active');
            if (tabContent) {
                tabContent.classList.add('active');
            } else {
                console.error(`Tab content with id "${tabId}" not found.`);
            }
        } else if (!tabButton) {
             console.error(`Tab button with data-tab="${tabId}" not found.`);
        } else {
            console.log(`Tab ${tabId} is hidden, cannot activate.`);
             // Optionally, activate a default tab like 'settings' if the target is hidden
             activateTab('settings');
        }
    }

    // Add event listeners to all tab buttons
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function () {
            if (!this.classList.contains('hidden')) {
                  activateTab(this.dataset.tab);
                  if (this.dataset.tab === 'buildings' && typeof markBuildingsViewed === 'function') {
                      markBuildingsViewed();
                  }
                  if (this.dataset.tab === 'special-projects' && typeof markProjectsViewed === 'function') {
                      markProjectsViewed();
                  }
            } else {
                 console.log(`Tab ${this.dataset.tab} is hidden and cannot be clicked.`);
            }
        });
    });


    // Event listener for "New Game" button
    document.getElementById('new-game-button').addEventListener('click', () => {
        if (confirm("Are you sure you want to start a new game? Any unsaved progress will be lost.")) {
            if (typeof startNewGame === 'function') {
                startNewGame();
            } else {
                initializeGameState();
            }
            activateTab('settings');
        }
    });

    // Event listener for the "Save to File" button
    document.getElementById('save-to-file-button').addEventListener('click', saveGameToFile);

    // Event listener for the "Load from File" button trigger
    document.getElementById('load-from-file-button').addEventListener('click', function() {
        document.getElementById('load-from-file-input').click();
    });

    // Event listener for the actual file input change
    document.getElementById('load-from-file-input').addEventListener('change', loadGameFromFile);

    const celsiusToggle = document.getElementById('celsius-toggle');
    if (celsiusToggle) {
        celsiusToggle.checked = gameSettings.useCelsius;
        celsiusToggle.addEventListener('change', () => {
            gameSettings.useCelsius = celsiusToggle.checked;
            updateTerraformingUI();
            if (typeof updateBuildingDisplay === 'function') {
                updateBuildingDisplay(buildings);
            }
        });
    }

    const silenceToggle = document.getElementById('solis-silence-toggle');
    if (silenceToggle) {
        silenceToggle.checked = gameSettings.silenceSolisAlert;
        silenceToggle.addEventListener('change', () => {
            gameSettings.silenceSolisAlert = silenceToggle.checked;
            updateHopeAlert();
        });
    }

    const unlockToggle = document.getElementById('unlock-alert-toggle');
    if (unlockToggle) {
        unlockToggle.checked = gameSettings.silenceUnlockAlert;
        unlockToggle.addEventListener('change', () => {
            gameSettings.silenceUnlockAlert = unlockToggle.checked;
            if (typeof updateBuildingAlert === 'function') updateBuildingAlert();
            if (typeof updateProjectAlert === 'function') updateProjectAlert();
        });
    }

    const dayNightToggle = document.getElementById('day-night-toggle');
    if (dayNightToggle) {
        dayNightToggle.checked = gameSettings.disableDayNightCycle;
        dayNightToggle.addEventListener('change', () => {
            gameSettings.disableDayNightCycle = dayNightToggle.checked;
            if (typeof applyDayNightSettingEffects === 'function') applyDayNightSettingEffects();
            updateDayNightDisplay();
            if (typeof updateBuildingDisplay === 'function') {
                updateBuildingDisplay(buildings);
            }
        });
    }

    const pauseButton = document.getElementById("pause-button");
    if (pauseButton) {
        pauseButton.addEventListener("click", togglePause);
    }
     // Ensure the initially active tab content is displayed on load
     // (The 'settings' tab has 'active' class in HTML, so this might be redundant
     // unless dynamically changing the default)
     // document.addEventListener('DOMContentLoaded', () => {
     //    activateTab('settings'); // Or whichever tab should be active first
     // });

    </script>
</body>

</html>